{{define "header"}}
<header class="header">
    <div class="logo">
        <a href="/">Ginger</a>
    </div>
    <nav class="nav">
        <ul>
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li class="dropdown">
                <button id="catalog-toggle" class="catalog-toggle">–ö–∞—Ç–∞–ª–æ–≥</button>
                <div class="dropdown-content" id="categories-menu">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </li>
            {{if .user}}
                <li><a href="/cart">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
                <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                <li><a href="/logout">–í—ã–π—Ç–∏</a></li>
            {{else}}
                <li><a href="#" onclick="openModal('login-modal'); return false;">–í—Ö–æ–¥</a></li>
                <li><a href="#" onclick="openModal('register-modal'); return false;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
            {{end}}
        </ul>
    </nav>


    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('login-modal')">&times;</span>
            <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
            <form id="login-form" method="POST" action="http://localhost:8080/authorization" onsubmit="setTimeout(() => window.location.reload(), 100)">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" name="email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="login-password" name="password" class="form-control" required>
                        <span class="toggle-password" onclick="togglePassword('login-password')">üëÅÔ∏è</span>
                    </div>
                </div>
                <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
                <div class="auth-footer">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" onclick="switchToRegister(); return false;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('register-modal')">&times;</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <form id="register-form" method="POST" action="http://localhost:8080/registration" onsubmit="setTimeout(() => window.location.reload(), 100)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">–ò–º—è</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" name="email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reg-password">–ü–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="reg-password" name="password" class="form-control" required>
                        <span class="toggle-password" onclick="togglePassword('reg-password')">üëÅÔ∏è</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reg-confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <div class="password-wrapper">
                        <input type="password" id="reg-confirm-password" name="confirm_password" class="form-control" required>
                        <span class="toggle-password" onclick="togglePassword('reg-confirm-password')">üëÅÔ∏è</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="role">–í—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –∏–ª–∏ –ø–æ–∫—É–ø–∞—Ç—å —Ç–æ–≤–∞—Ä—ã?</label>
                        <div class="role-switch">
                            <input type="radio" id="role-customer" name="role" value="customer" checked>
                            <label for="role-customer">–ü–æ–∫—É–ø–∞—Ç—å</label>
                            
                            <input type="radio" id="role-salesman" name="role" value="salesman">
                            <label for="role-salesman">–ü—Ä–æ–¥–∞–≤–∞—Ç—å</label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div class="auth-footer">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" onclick="switchToLogin(); return false;">–í–æ–π–¥–∏—Ç–µ</a>
                </div>
            </form>
        </div>
    </div>
</header>

<style>
    .logo {
        background-color: #2c3e50;
        font-size: 1.8rem;
        font-weight: bold;
    }
    
    .logo a {
        color: white;
        text-decoration: none;
    }
  /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –Ω–∞–≤–±–∞—Ä–∞ */
    .nav {
        background-color: #2c3e50; /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
    }
    
    .nav ul {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        align-items: center;
        gap: 15px;
    }

    .nav li {
        position: relative;
        height: 100%;
        display: flex;
        align-items: center;
    }

    .nav a {
        color: white; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
        text-decoration: none;
        font-weight: 500;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        height: 100%;
        transition: color 0.3s;
    }

    .nav a:hover {
        color: #3498db; /* –ì–æ–ª—É–±–æ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ */
    .catalog-toggle {
        background: none;
        border: none;
        color: white; /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç */
        font: inherit;
        cursor: pointer;
        padding: 10px 15px;
        font-weight: 500;
        display: flex;
        align-items: center;
        height: 100%;
        transition: color 0.3s;
    }

    .catalog-toggle:hover {
        color: #3498db; /* –ì–æ–ª—É–±–æ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é */
    .dropdown {
        height: 100%;
        display: flex;
        align-items: center;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        left: 0;
        top: 100%;
        background-color: #fff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω */
        min-width: 250px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        z-index: 1000;
        padding: 10px 0;
        border-radius: 0 0 4px 4px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    .category-item {
        border-bottom: 1px solid #eee;
    }

    .category-header {
        width: 100%;
        text-align: left;
        padding: 8px 15px;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 500;
        color: #2c3e50; /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç */
    }

    .category-header:hover {
        background-color: #f8f9fa;
    }

    .subcategory-list {
        display: none;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .subcategory-list li a {
        display: block;
        padding: 8px 25px;
        color: #555; /* –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç */
        text-decoration: none;
        transition: all 0.2s;
    }

    .subcategory-list li a:hover {
        background-color: #f8f9fa;
        color: #3498db; /* –ì–æ–ª—É–±–æ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        padding-left: 30px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .dropdown-content {
            width: 100%;
            box-sizing: border-box;
        }
        
        .nav ul {
            gap: 10px;
        }
        
        .nav a, .catalog-toggle {
            padding: 10px 8px;
        }
    }
    
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        overflow: auto;
    }
    
    .modal-content {
        background-color: #fff;
        margin: 2% auto; /* –ú–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
        padding: 2rem;
        border-radius: 8px;
        width: 90%;
        max-width: 400px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: modalopen 0.3s;
        color: #333;
        position: relative;
    }
    
    .form-container {
        overflow-y: auto;
        max-height: calc(90vh - 120px); /* –û—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Å—Ç–æ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Ñ—É—Ç–µ—Ä–∞ */
        padding-right: 5px; /* –ß—Ç–æ–±—ã –Ω–µ –∑–∞–µ–∑–∂–∞–ª —Å–∫—Ä–æ–ª–ª –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç */
    }
    
    @keyframes modalopen {
        from {opacity: 0; transform: translateY(-50px);}
        to {opacity: 1; transform: translateY(0);}
    }
    
    .close-btn {
        float: right;
        font-size: 1.5rem;
        cursor: pointer;
        color: #7f8c8d;
    }
    
    .close-btn:hover {
        color: #333;
    }
    
    /* –°—Ç–∏–ª–∏ —Ñ–æ—Ä–º */
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    
    .btn {
        display: block;
        width: 100%;
        padding: 0.75rem;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    
    .btn:hover {
        background-color: #2980b9;
    }
    
    .auth-footer {
        text-align: center;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid #eee;
    }
    
    .auth-footer a {
        color: #3498db;
        text-decoration: none;
    }
    
    .auth-footer a:hover {
        text-decoration: underline;
    }
    
    .form-row {
        display: flex;
        gap: 1rem;
    }
    
    .form-row .form-group {
        flex: 1;
    }
    .password-wrapper {
        position: relative;
    }
    
    .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        user-select: none;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ä–æ–ª–µ–π */
    .role-switch {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
    }
    
    .role-switch input[type="radio"] {
        display: none;
    }
    
    .role-switch label {
        padding: 0.5rem 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .role-switch input[type="radio"]:checked + label {
        background-color: #3498db;
        color: white;
        border-color: #3498db;
    }
</style>

<script>
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
    function openModal(modalId) {
        closeAllModals();
        document.getElementById(modalId).style.display = 'block';
        document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        document.body.style.overflow = ''; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    }
    
    function closeAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
        });
        document.body.style.overflow = '';
    }
    
    function switchToRegister() {
        closeModal('login-modal');
        openModal('register-modal');
    }
    
    function switchToLogin() {
        closeModal('register-modal');
        openModal('login-modal');
    }

    //–î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    function togglePassword(fieldId) {
        const passwordField = document.getElementById(fieldId);
        if (passwordField.type === 'password') {
            passwordField.type = 'text';
        } else {
            passwordField.type = 'password';
        }
    }
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    window.onclick = function(event) {
        if (event.target.className === 'modal') {
            closeAllModals();
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ fetch/AJAX)
    document.getElementById('login-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX-–∑–∞–ø—Ä–æ—Å
        this.submit();
    });
    
     // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ JSON
     document.getElementById('register-form')?.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = {
            name: this.elements['name'].value,
            email: this.elements['email'].value,
            password: this.elements['password'].value,
            confirm_password: this.elements['confirm_password'].value,
            role: this.elements['role'].value
        };
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
        fetch(this.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
            closeAllModals();
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        })
        .catch((error) => {
            console.error('Error:', error);
        });

        closeAllModals();
    });

        // –î–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const categoriesData = {
        "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è": ["–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã", "–ú—è—Å–æ", "–†—ã–±–∞", "–§—Ä—É–∫—Ç—ã", "–û–≤–æ—â–∏", "–ë–∞–∫–∞–ª–µ—è", "–ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è", "–ù–∞–ø–∏—Ç–∫–∏"],
        "–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è": ["–ú–æ—é—â–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞", "–°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —É–±–æ—Ä–∫–∏", "–°—Ä–µ–¥—Å—Ç–≤–∞ –ª–∏—á–Ω–æ–π –≥–∏–≥–∏–µ–Ω—ã"],
        "–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å": ["–ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞", "–ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞", "–î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞", "–û–±—É–≤—å", "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã"],
        "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": ["–¢–µ–ª–µ—Ñ–æ–Ω—ã", "–ö–æ–º–ø—å—é—Ç–µ—Ä—ã", "–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã", "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞"],
        "–¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞": ["–ú–µ–±–µ–ª—å", "–ü–æ—Å—É–¥–∞", "–¢–µ–∫—Å—Ç–∏–ª—å", "–î–µ–∫–æ—Ä"]
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è URL
    function createCategoryUrl(category, subcategory) {
        const formattedCategory = category.toLowerCase().replace(/\s+/g, '-');
        const formattedSubcategory = subcategory.toLowerCase().replace(/\s+/g, '-');
        return `/products/${formattedCategory}/${formattedSubcategory}`;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    function renderCategories() {
        const menu = document.getElementById('categories-menu');
        menu.innerHTML = '';
        
        for (const [category, subcategories] of Object.entries(categoriesData)) {
            const categoryItem = document.createElement('div');
            categoryItem.className = 'category-item';
            
            const categoryHeader = document.createElement('button');
            categoryHeader.className = 'category-header';
            categoryHeader.textContent = category;
            
            const subcategoryList = document.createElement('ul');
            subcategoryList.className = 'subcategory-list';
            
            subcategories.forEach(subcategory => {
                const item = document.createElement('li');
                const link = document.createElement('a');
                link.href = createCategoryUrl(category, subcategory);
                link.textContent = subcategory;
                item.appendChild(link);
                subcategoryList.appendChild(item);
            });
            
            categoryItem.appendChild(categoryHeader);
            categoryItem.appendChild(subcategoryList);
            menu.appendChild(categoryItem);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            categoryHeader.addEventListener('click', function() {
                this.classList.toggle('active');
                const list = this.nextElementSibling;
                list.style.display = list.style.display === 'block' ? 'none' : 'block';
            });
        }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º/–∑–∞–∫—Ä—ã—Ç–∏–µ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é
    document.addEventListener('DOMContentLoaded', () => {
        renderCategories();
        
        const toggleBtn = document.getElementById('catalog-toggle');
        const dropdown = document.getElementById('categories-menu');
        let isMenuOpen = false;
        
        toggleBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isMenuOpen = !isMenuOpen;
            dropdown.style.display = isMenuOpen ? 'block' : 'none';
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
        document.addEventListener('click', () => {
            if (isMenuOpen) {
                dropdown.style.display = 'none';
                isMenuOpen = false;
            }
        });
    });
</script>
{{end}}